<div class="dashboard-container">
  <div class="background-decoration">
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="cloud cloud-3"></div>
    <div class="star star-1">‚≠ê</div>
    <div class="star star-2">‚≠ê</div>
    <div class="star star-3">‚≠ê</div>
    <div class="rainbow"></div>
  </div>

  <header class="main-header">
    <div class="header-left">
      <span class="star-icon">‚≠ê</span>
      <a routerLink="/zona-profesional" class="home-link">Regresar</a>
    </div>
    <div class="header-center">
      <img src="assets/images/logo.png" alt="ARENYS CONTIGO " class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
      <h1 class="main-logo fallback" style="display: none;">- ARENYS CONTIGO -</h1>
    </div>
    <div class="header-right">
      <span class="icon">üí¨</span>
      <span class="icon">üë§</span>
      <div class="dropdown">
        <select class="dropdown-select" (change)="onSelectChange($event)">
          <option value="">{{ user?.name || 'Usuario' }}</option>
          <option value="logout">Cerrar Sesi√≥n</option>
        </select>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="form-container">
      <h1>Nueva Historia Cl√≠nica</h1>
      <form [formGroup]="historiaClinicaForm" (ngSubmit)="onSubmit()" class="historia-form">
        <div class="form-section">
          <h2>Informaci√≥n del Paciente</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="nombrePaciente">Nombre del Paciente *</label>
              <input type="text" id="nombrePaciente" formControlName="nombrePaciente" placeholder="Ingrese el nombre completo">
            </div>
            <div class="form-group">
              <label for="fechaNacimiento">Fecha de Nacimiento *</label>
              <input type="date" id="fechaNacimiento" formControlName="fechaNacimiento">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="genero">G√©nero *</label>
              <select id="genero" formControlName="genero">
                <option value="">Seleccione</option>
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="telefono">Tel√©fono</label>
              <input type="tel" id="telefono" formControlName="telefono" placeholder="N√∫mero de tel√©fono">
            </div>
          </div>
          <div class="form-group">
            <label for="direccion">Direcci√≥n</label>
            <input type="text" id="direccion" formControlName="direccion" placeholder="Direcci√≥n completa">
          </div>
          <div class="form-group">
            <label for="email">Correo Electr√≥nico</label>
            <input type="email" id="email" formControlName="email" placeholder="correo@ejemplo.com">
          </div>
        </div>

        <div class="form-section">
          <h2>Informaci√≥n Familiar</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="nombrePadre">Nombre del Padre *</label>
              <input type="text" id="nombrePadre" formControlName="nombrePadre" placeholder="Nombre completo del padre">
            </div>
            <div class="form-group">
              <label for="nombreMadre">Nombre de la Madre *</label>
              <input type="text" id="nombreMadre" formControlName="nombreMadre" placeholder="Nombre completo de la madre">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="nombreAcudiente">Nombre del Acudiente *</label>
              <input type="text" id="nombreAcudiente" formControlName="nombreAcudiente" placeholder="Nombre completo del acudiente">
            </div>
            <div class="form-group">
              <label for="parentescoAcudiente">Parentesco del Acudiente *</label>
              <select id="parentescoAcudiente" formControlName="parentescoAcudiente">
                <option value="">Seleccione</option>
                <option value="papa">Pap√°</option>
                <option value="mama">Mam√°</option>
                <option value="abuelos">Abuelos</option>
                <option value="tios">T√≠os</option>
                <option value="otros">Otros</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="tieneHermanosColegio">¬øTiene hermanos/as en el colegio?</label>
              <select id="tieneHermanosColegio" formControlName="tieneHermanosColegio">
                <option value="">Seleccione</option>
                <option value="si">S√≠</option>
                <option value="no">No</option>
              </select>
            </div>
            <div class="form-group">
              <label for="gradoHermano">Grado del hermano/a</label>
              <input type="text" id="gradoHermano" formControlName="gradoHermano" placeholder="Ej: 3ro de primaria">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2>Informaci√≥n M√©dica</h2>
          <div class="form-group">
            <label for="motivoConsulta">Motivo de Consulta *</label>
            <div class="textarea-container">
              <textarea id="motivoConsulta" formControlName="motivoConsulta" rows="3" placeholder="Describa el motivo de la consulta"></textarea>
              <button type="button" class="btn-mic" (click)="toggleSpeechRecognition('motivoConsulta')" [class.listening]="isListening">
                üé§
              </button>
            </div>
          </div>
          <div class="form-group">
            <label for="antecedentesMedicos">Antecedentes M√©dicos</label>
            <textarea id="antecedentesMedicos" formControlName="antecedentesMedicos" rows="4" placeholder="Historial m√©dico relevante, alergias, medicamentos, etc."></textarea>
          </div>
          <div class="form-group">
            <label for="sintomasActuales">S√≠ntomas Actuales *</label>
            <textarea id="sintomasActuales" formControlName="sintomasActuales" rows="4" placeholder="Describa los s√≠ntomas actuales"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h2>Diagn√≥stico y Tratamiento</h2>
          <div class="form-group">
            <label for="diagnostico">Diagn√≥stico</label>
            <textarea id="diagnostico" formControlName="diagnostico" rows="3" placeholder="Diagn√≥stico m√©dico"></textarea>
          </div>
          <div class="form-group">
            <label for="planTratamiento">Plan de Tratamiento</label>
            <textarea id="planTratamiento" formControlName="planTratamiento" rows="4" placeholder="Plan de tratamiento recomendado"></textarea>
          </div>
          <div class="form-group">
            <label for="notas">Notas Adicionales</label>
            <textarea id="notas" formControlName="notas" rows="3" placeholder="Observaciones adicionales"></textarea>
          </div>
        </div>
        <div class="form-section">
          <h2>PIAR</h2>
          <div class="form-group">
            <label for="archivos">Archivos (Im√°genes o PDFs)</label>
            <input type="file" id="archivos" multiple accept="image/*,.pdf" (change)="onFileChange($event)">
          </div>
          <div *ngIf="selectedFiles.length > 0" class="selected-files">
            <h3>Archivos Seleccionados:</h3>
            <ul>
              <li *ngFor="let file of selectedFiles; let i = index">
                {{ file.name }} ({{ (file.size / 1024).toFixed(2) }} KB)
                <button type="button" (click)="removeFile(i)" class="btn-remove-file">‚ùå</button>
              </li>
            </ul>
          </div>
        </div>

        <div class="form-section">
          <h2>Sesiones de Terapia</h2>
          <button type="button" class="btn-add" (click)="agregarSesion()">Agregar Sesi√≥n</button>
          <div class="sesiones-list" formArrayName="sesiones">
            <div *ngFor="let sesion of sesiones.controls; let i = index" [formGroupName]="i" class="sesion-item">
              <div class="sesion-header">
                <h3>Sesi√≥n {{ i + 1 }}</h3>
                <button type="button" class="btn-remove" (click)="eliminarSesion(i)">Eliminar</button>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Fecha *</label>
                  <input type="date" formControlName="fecha">
                </div>
                <div class="form-group">
                  <label>Tipo de Sesi√≥n *</label>
                  <select formControlName="tipo">
                    <option value="">Seleccione</option>
                    <option value="evaluacion">Evaluaci√≥n Inicial</option>
                    <option value="terapia">Sesi√≥n de Terapia</option>
                    <option value="seguimiento">Seguimiento</option>
                    <option value="cierre">Cierre</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Notas de la Sesi√≥n *</label>
                <textarea formControlName="notas" rows="3" placeholder="Notas detalladas de la sesi√≥n"></textarea>
              </div>
              <div class="form-group">
                <label>Objetivos</label>
                <textarea formControlName="objetivos" rows="2" placeholder="Objetivos trabajados en la sesi√≥n"></textarea>
              </div>
              <div class="form-group">
                <label>Progreso</label>
                <textarea formControlName="progreso" rows="2" placeholder="Progreso observado"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit" [disabled]="!historiaClinicaForm.valid">Crear Historia Cl√≠nica</button>
        </div>
      </form>
    </div>
  </main>

  <!-- Modal de sesi√≥n expirada -->
  <div *ngIf="showModal" class="modal-overlay">
    <div class="modal-content">
      <h2>Sesi√≥n Expirada</h2>
      <p>Por favor, vuelve a abrir sesi√≥n porque el tiempo se ha cerrado.</p>
      <button class="btn-accept" (click)="closeModalAndLogout()">Aceptar</button>
    </div>
  </div>
</div>
