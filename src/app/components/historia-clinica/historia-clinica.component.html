<div class="zona-container">
  <div class="background-decoration">
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="star star-1">â­</div>
    <div class="star star-2">â­</div>
  </div>

  <header class="section-header">
    <div class="header-left">
      <span class="gear-icon">âš™ï¸</span>
      <a routerLink="/zona-profesional" class="home-link">â† Volver</a>
    </div>
    <div class="header-center">
      <h1 class="section-title">Historia Clinica</h1>
    </div>
    <div class="header-right">
      <div class="dropdown">
        <select class="dropdown-select" (change)="onSelectChange($event)">
          <option value="">Usuario</option>
          <option value="logout">Cerrar SesiÃ³n</option>
        </select>
      </div>
    </div>
  </header>

  <main class="main-content">
   <div class="welcome-section">
     <h2 class="welcome-title">
       GestiÃ³n de Historias ClÃ­nicas
       <span class="title-star">â­</span>
     </h2>
     <p class="welcome-subtitle">Administra y consulta las historias clÃ­nicas de tus pacientes de manera eficiente</p>

     <!-- BotÃ³n Nueva Historia, Buscador y Filtro -->
     <div class="actions-section">
       <button class="btn-nueva-historia" routerLink="/nueva-historia-clinica">+ Nueva Historia ClÃ­nica</button>
       <div class="search-container">
         <input type="text" placeholder="Buscar por nombre del paciente..." class="search-input" [(ngModel)]="searchTerm" (input)="filterHistorias()">
         <span class="search-icon">ğŸ”</span>
       </div>
       <div class="filter-container">
         <select class="filter-select" [(ngModel)]="selectedRiskLevel" (change)="filterHistorias()">
           <option value="">Filtrar por Nivel de Riesgo</option>
           <option value="todos">Todos</option>
           <option value="critico">ğŸ”´ CrÃ­tico / Emergencia</option>
           <option value="alto">ğŸŸ  Alto</option>
           <option value="medio">ğŸŸ¡ Medio</option>
           <option value="bajo">ğŸŸ¢ Bajo / Preventivo</option>
         </select>
       </div>
     </div>
   </div>

   <div class="historia-section">
     <h2 class="subsection-title">Historias ClÃ­nicas {{ (searchTerm || selectedRiskLevel) ? '(Filtradas)' : 'Recientes' }}</h2>

     <div class="historia-list">
       <div class="historia-card" *ngFor="let historia of filteredHistorias">
         <div class="historia-header">
           <div class="paciente-info">
             <h3 class="paciente-nombre">{{ historia.pacienteNombre }}</h3>
             <span class="riesgo-badge" [ngClass]="getRiesgoClass(historia.nivelRiesgo)" *ngIf="historia.nivelRiesgo">
               {{ getRiesgoLabel(historia.nivelRiesgo) }}
             </span>
           </div>
           <span class="historia-fecha">{{ historia.fecha }}</span>
         </div>
         <div class="historia-content">
           <p class="historia-resumen">{{ historia.resumen }}</p>
           <div class="historia-tags">
             <span class="tag" *ngFor="let tag of historia.tags">{{ tag }}</span>
           </div>
           <div class="historia-sesiones" *ngIf="historia.tieneSesiones">
             <div class="sesiones-info">
               <span class="sesiones-count">ğŸ“… {{ historia.numSesiones }} sesiÃ³n{{ historia.numSesiones > 1 ? 'es' : '' }}</span>
               <div class="ultima-sesion" *ngIf="historia.ultimaSesion">
                 <small>Ãšltima: {{ historia.ultimaSesion.fecha | date:'dd/MM/yyyy' }} - {{ historia.ultimaSesion.tipo }}</small>
               </div>
             </div>
           </div>
         </div>
         <div class="historia-actions">
           <button class="btn-ver" (click)="verDetalles(historia)">Ver Detalles</button>
           <button class="btn-editar" (click)="editar(historia)">Editar</button>
           <button class="btn-eliminar" (click)="eliminar(historia)">Eliminar</button>
         </div>
       </div>
     </div>

     <!-- Mensaje cuando no hay resultados -->
     <div class="no-results" *ngIf="filteredHistorias.length === 0">
       <p>No se encontraron historias clÃ­nicas con los filtros aplicados.</p>
     </div>
   </div>

  </main>

  <!-- Modal de confirmaciÃ³n -->
  <div class="modal-overlay" *ngIf="showDeleteModal">
    <div class="modal-content">
      <p class="modal-message">Â¿EstÃ¡s segura PsicÃ³loga Carolina de eliminar esta historia clÃ­nica?</p>
      <div class="modal-buttons">
        <button class="btn-si" (click)="confirmarEliminar()">SÃ­</button>
        <button class="btn-no" (click)="cancelarEliminar()">No</button>
      </div>
    </div>
  </div>
</div>
